<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AKS-CL Attendance & Salary</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    body {
      background: linear-gradient(135deg, #4A00E0 0%, #8E2DE2 100%);
      min-height: 100vh;
      padding: 20px;
      animation: gradientShift 15s ease infinite;
      background-size: 400% 400%;
    }

    @keyframes gradientShift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    /* Password Modal */
    #passwordModal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.85);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 3000;
    }

    .password-box {
      background: white;
      padding: 30px;
      border-radius: 16px;
      width: 90%;
      max-width: 400px;
      text-align: center;
      box-shadow: 0 10px 30px rgba(0,0,0,0.6);    }

    .password-box h2 {
      color: #6a0dad;
      margin-bottom: 20px;
    }

    #passwordInput {
      width: 100%;
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 18px;
      text-align: center;
      margin-bottom: 15px;
    }

    #submitPassword {
      background: linear-gradient(45deg, #8E2DE2, #6a0dad);
      color: white;
      border: none;
      padding: 12px 20px;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
      width: 100%;
    }

    #passwordError {
      color: #e74c3c;
      margin-top: 15px;
      font-weight: bold;
      font-size: 16px;
      min-height: 24px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    h1 {
      text-align: center;
      color: white;
      margin-bottom: 20px;
      font-size: 32px;
      text-shadow: 0 2px 6px rgba(0,0,0,0.3);
    }

    .salary-input-section {      display: flex;
      justify-content: center;
      gap: 12px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    #salaryInput {
      padding: 12px 16px;
      border: none;
      border-radius: 50px;
      font-size: 16px;
      font-weight: bold;
      width: 180px;
      text-align: center;
      box-shadow: 0 4px 12px rgba(0,0,0,0.25);
    }

    #updateSalaryBtn {
      padding: 12px 20px;
      background: linear-gradient(45deg, #6a0dad, #9b59b6);
      color: white;
      border: none;
      border-radius: 50px;
      font-weight: bold;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(0,0,0,0.25);
      transition: all 0.3s ease;
    }

    .controls {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin-bottom: 25px;
      flex-wrap: wrap;
    }

    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: 50px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 15px;
      color: white;
      box-shadow: 0 4px 12px rgba(0,0,0,0.25);
      position: relative;
      overflow: hidden;    }

    .export-btn { background: linear-gradient(45deg, #00b09b, #96c93d); }
    .import-btn { background: linear-gradient(45deg, #8E2DE2, #4A00E0); }
    .reset-btn { background: linear-gradient(45deg, #6a0dad, #9b59b6); }

    .btn:hover {
      transform: translateY(-4px) scale(1.03);
      box-shadow: 0 8px 20px rgba(0,0,0,0.35);
    }

    .salary-summary {
      background: linear-gradient(45deg, #8E2DE2, #4A00E0);
      color: white;
      padding: 18px;
      border-radius: 16px;
      text-align: center;
      margin-bottom: 25px;
      font-weight: bold;
      box-shadow: 0 6px 20px rgba(0,0,0,0.3);
    }

    .month-section {
      background: white;
      border-radius: 16px;
      box-shadow: 0 8px 25px rgba(74, 0, 224, 0.2);
      padding: 22px;
      margin-bottom: 25px;
      transition: transform 0.3s ease;
      position: relative;
    }

    .print-btn {
      position: absolute;
      top: 15px;
      right: 15px;
      background: #6a0dad;
      color: white;
      border: none;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      font-weight: bold;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
      transition: all 0.2s;
      z-index: 10;    }

    .print-btn:hover {
      background: #8e2de2;
      transform: scale(1.1);
    }

    .month-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 18px;
      padding: 12px 48px 12px 16px; /* ‚Üê Extra right padding for print button */
      background: linear-gradient(90deg, #6a0dad, #8E2DE2);
      color: white;
      border-radius: 12px;
      font-weight: bold;
      box-shadow: 0 4px 10px rgba(74, 0, 224, 0.25);
      position: relative;
    }

    .days-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(45px, 1fr));
      gap: 8px;
    }

    .day-cell {
      text-align: center;
      padding: 8px 5px;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.25s ease;
      position: relative;
    }

    .day-label {
      font-size: 13px;
      font-weight: bold;
      color: #555;
      margin-bottom: 4px;
    }

    .status-btn {
      width: 100%;
      padding: 6px 0;
      border: none;
      border-radius: 8px;
      font-size: 12px;
      font-weight: bold;      cursor: pointer;
      transition: all 0.25s ease;
      position: relative;
    }

    .status-P { background: linear-gradient(135deg, #2ecc71, #27ae60); color: white; }
    .status-OF { background: linear-gradient(135deg, #f39c12, #d35400); color: white; }
    .status-LV { 
      background: linear-gradient(135deg, #9b59b6, #8e44ad); 
      color: white;
    }
    .status-empty { background: linear-gradient(135deg, #ecf0f1, #bdc3c7); color: #7f8c8d; }

    .lv-reason {
      font-size: 10px;
      color: #6c757d;
      margin-top: 4px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      padding: 0 2px;
    }

    #leaveModal {
      display: none;
      position: fixed;
      z-index: 2000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.6);
    }

    .modal-content {
      background: white;
      margin: 10% auto;
      padding: 25px;
      border-radius: 16px;
      width: 90%;
      max-width: 400px;
      box-shadow: 0 8px 25px rgba(0,0,0,0.4);
    }

    .modal-content h3 {
      margin-bottom: 15px;
      color: #6a0dad;
      text-align: center;
    }
    #leaveReasonInput {
      width: 100%;
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 15px;
      margin-bottom: 15px;
    }

    .modal-buttons {
      display: flex;
      gap: 10px;
    }

    .modal-btn {
      flex: 1;
      padding: 10px;
      border: none;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
    }

    #saveLeaveBtn {
      background: linear-gradient(45deg, #8E2DE2, #6a0dad);
      color: white;
    }

    #cancelLeaveBtn {
      background: #ecf0f1;
      color: #7f8c8d;
    }

    #fileInput {
      display: none;
    }

    @media print {
      body {
        background: white !important;
        animation: none !important;
        padding: 0 !important;
      }
      .no-print {
        display: none !important;
      }
      .month-section {
        box-shadow: none !important;
        border: 1px solid #ccc;
      }      .print-btn {
        display: none !important;
      }
    }

    @media (max-width: 768px) {
      .salary-input-section,
      .controls {
        flex-direction: column;
        align-items: center;
      }
      #salaryInput, .btn {
        width: 90%;
        max-width: 280px;
      }
      .days-row {
        grid-template-columns: repeat(auto-fit, minmax(35px, 1fr));
      }
      .day-cell { padding: 6px 3px; }
      .status-btn { padding: 4px 0; font-size: 11px; }
      .lv-reason { font-size: 9px; }
      .month-header {
        padding: 10px 44px 10px 12px; /* Slightly reduced on mobile */
        font-size: 14px;
      }
    }
  </style>
</head>
<body>
  <!-- üîí Password Modal -->
  <div id="passwordModal">
    <div class="password-box">
      <h2>üîí Enter Password</h2>
      <input type="password" id="passwordInput" placeholder="Enter password" maxlength="6" />
      <button id="submitPassword">Unlock</button>
      <div id="passwordError"></div>
    </div>
  </div>

  <!-- Main App (initially hidden) -->
  <div class="container" id="mainApp" style="display:none;">
    <h1 class="no-print">AKS-CL Attendance & Salary Tracker</h1>

    <div class="salary-input-section no-print">
      <input type="number" id="salaryInput" placeholder="Enter monthly salary" min="1" value="16000" />
      <button id="updateSalaryBtn">Update Salary</button>
    </div>

    <div class="controls no-print">
      <button class="btn export-btn" id="exportBtn">üì• Export Data (TXT)</button>      <button class="btn import-btn" id="importBtn">üì§ Import Data (TXT)</button>
      <button class="btn reset-btn" id="resetBtn">üóëÔ∏è Reset All Data</button>
    </div>

    <input type="file" id="fileInput" accept=".txt">
    <div class="salary-summary no-print" id="globalSummary">
      Loading...
    </div>

    <div id="attendanceContainer"></div>
  </div>

  <!-- Leave Reason Modal -->
  <div id="leaveModal">
    <div class="modal-content">
      <h3>Leave Reason</h3>
      <input type="text" id="leaveReasonInput" placeholder="e.g., Sick, Personal Work..." maxlength="50" />
      <div class="modal-buttons">
        <button class="modal-btn" id="saveLeaveBtn">Save</button>
        <button class="modal-btn" id="cancelLeaveBtn">Cancel</button>
      </div>
    </div>
  </div>

  <script>
    // === PASSWORD PROTECTION ===
    const CORRECT_PASSWORD = "999897";
    const passwordModal = document.getElementById('passwordModal');
    const mainApp = document.getElementById('mainApp');

    document.getElementById('submitPassword').addEventListener('click', checkPassword);
    document.getElementById('passwordInput').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') checkPassword();
    });

    function checkPassword() {
      const input = document.getElementById('passwordInput').value;
      const errorEl = document.getElementById('passwordError');
      
      if (input === CORRECT_PASSWORD) {
        passwordModal.style.display = 'none';
        mainApp.style.display = 'block';
        initializeApp();
      } else {
        errorEl.innerHTML = `ü´µ‚úäüëä u don't have access close this aks server`;
        document.getElementById('passwordInput').value = '';
        document.getElementById('passwordInput').focus();
      }
    }
    // === APP LOGIC ===
    function initializeApp() {
      let MONTHLY_SALARY = parseInt(localStorage.getItem('monthlySalary')) || 16000;
      document.getElementById('salaryInput').value = MONTHLY_SALARY;

      const months = [
        { name: "SEP-2025", days: 30 },
        { name: "OCT-2025", days: 31 },
        { name: "NOV-2025", days: 30 },
        { name: "DEC-2025", days: 31 },
        { name: "JAN-2026", days: 31 },
        { name: "FEB-2026", days: 28 },
        { name: "MAR-2026", days: 31 },
        { name: "APR-2026", days: 30 },
        { name: "MAY-2026", days: 31 },
        { name: "JUN-2026", days: 30 },
        { name: "JUL-2026", days: 31 },
        { name: "AUG-2026", days: 31 },
        { name: "SEP-2026", days: 30 },
        { name: "OCT-2026", days: 31 },
        { name: "NOV-2026", days: 30 },
        { name: "DEC-2026", days: 31 }
      ];

      let attendanceData = JSON.parse(localStorage.getItem('attendanceData')) || {};

      function checkTodayAttendance() {
        const today = new Date();
        const year = today.getFullYear();
        const monthIndex = today.getMonth();
        const day = today.getDate();

        const monthNames = [
          "JAN", "FEB", "MAR", "APR", "MAY", "JUN",
          "JUL", "AUG", "SEP", "OCT", "NOV", "DEC"
        ];
        const monthName = `${monthNames[monthIndex]}-${year}`;
        
        const monthConfig = months.find(m => m.name === monthName);
        if (!monthConfig || day > monthConfig.days) return;

        const monthId = monthName.replace(/-/g, '_').toLowerCase();
        if (!attendanceData[monthId]) {
          attendanceData[monthId] = {};
          for (let i = 1; i <= monthConfig.days; i++) attendanceData[monthId][i] = '';
        }

        const todayStatus = attendanceData[monthId][day];
        if (!todayStatus || todayStatus === '') {
          setTimeout(() => {            alert('‚ö†Ô∏è Aaj ka attendance abhi tak mark nahi kiya gaya hai!');
          }, 1000);
        }
      }

      function printMonth(monthName, monthId, totalDays) {
        let printContent = `
          <html>
          <head>
            <title>AKS-CL Attendance: ${monthName}</title>
            <style>
              body { font-family: Arial, sans-serif; padding: 20px; }
              h2 { color: #6a0dad; text-align: center; margin-bottom: 20px; }
              table { width: 100%; border-collapse: collapse; margin-top: 10px; }
              th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
              .P { background-color: #d4edda; color: #155724; }
              .OF { background-color: #fff3cd; color: #856404; }
              .LV { background-color: #f8d7da; color: #721c24; }
              .empty { background-color: #f1f1f1; color: #666; }
              .reason { font-size: 10px; color: #666; margin-top: 2px; }
            </style>
          </head>
          <body>
            <h2>AKS-CL Attendance Report: ${monthName}</h2>
            <table>
              <tr>
        `;

        for (let d = 1; d <= totalDays; d++) {
          printContent += `<th>${d}</th>`;
        }
        printContent += `</tr><tr>`;

        for (let d = 1; d <= totalDays; d++) {
          const record = attendanceData[monthId]?.[d] || '';
          let status = '';
          let reason = '';
          let className = 'empty';

          if (typeof record === 'object' && record.status === 'LV') {
            status = 'LV';
            reason = record.reason || '';
            className = 'LV';
          } else if (record === 'P') {
            status = 'P';
            className = 'P';
          } else if (record === 'OF') {
            status = 'OF';
            className = 'OF';
          } else {            status = '-';
          }
          printContent += `<td class="${className}">${status}${reason ? '<br><span class="reason">' + reason + '</span>' : ''}</td>`;
        }

        printContent += `</tr></table></body></html>`;

        const printWin = window.open('', '_blank');
        printWin.document.write(printContent);
        printWin.document.close();
        printWin.focus();
        printWin.print();
      }

      function updateSalary() {
        const input = document.getElementById('salaryInput');
        const value = parseInt(input.value);
        if (isNaN(value) || value <= 0) {
          alert('Please enter a valid salary amount.');
          input.value = MONTHLY_SALARY;
          return;
        }
        MONTHLY_SALARY = value;
        localStorage.setItem('monthlySalary', MONTHLY_SALARY);
        renderAttendance();
        updateGlobalSummary();
      }

      function exportData() {
        let txt = `AKS-CL Attendance Data Export\n`;
        txt += `Period: SEP-2025 to DEC-2026\n`;
        txt += `Monthly Salary: ‚Çπ${MONTHLY_SALARY}\n`;
        txt += `Generated on: ${new Date().toLocaleString()}\n\n--- DATA ---\n\n`;

        months.forEach(m => {
          const monthId = m.name.replace(/-/g, '_').toLowerCase();
          txt += `${m.name}:\n`;
          for (let day = 1; day <= m.days; day++) {
            const record = attendanceData[monthId]?.[day];
            if (typeof record === 'object' && record.status === 'LV') {
              txt += `${day}:LV|${record.reason || ''}\n`;
            } else {
              const status = record || '-';
              txt += `${day}:${status}\n`;
            }
          }
          txt += `\n`;
        });

        const blob = new Blob([txt], { type: 'text/plain;charset=utf-8' });        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `aks-cl_attendance_${new Date().toISOString().slice(0,10)}.txt`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      }

      function importData(text) {
        try {
          const lines = text.split('\n');
          let currentMonth = null;
          const newData = {};

          for (const line of lines) {
            const cleanLine = line.trim();
            if (!cleanLine || cleanLine.startsWith('AKS-CL') || cleanLine.startsWith('Period') || cleanLine.startsWith('Monthly Salary') || cleanLine.startsWith('Generated') || cleanLine === '--- DATA ---') {
              continue;
            }

            if (cleanLine.endsWith(':')) {
              currentMonth = cleanLine.slice(0, -1).replace(/-/g, '_').toLowerCase();
              newData[currentMonth] = {};
            } else if (currentMonth && cleanLine.includes(':')) {
              const [dayStr, value] = cleanLine.split(':');
              const day = parseInt(dayStr);
              if (isNaN(day)) continue;

              if (value.startsWith('LV|')) {
                const reason = value.substring(3);
                newData[currentMonth][day] = { status: 'LV', reason };
              } else {
                newData[currentMonth][day] = value === '-' ? '' : value;
              }
            }
          }

          const validMonths = months.map(m => m.name.replace(/-/g, '_').toLowerCase());
          for (const key in newData) {
            if (!validMonths.includes(key)) delete newData[key];
          }

          attendanceData = newData;
          localStorage.setItem('attendanceData', JSON.stringify(attendanceData));
          renderAttendance();
          alert('‚úÖ Data imported successfully!');
        } catch (err) {
          console.error(err);          alert('‚ùå Invalid file format.');
        }
      }

      function resetData() {
        if (confirm('‚ö†Ô∏è Delete all data?')) {
          localStorage.removeItem('attendanceData');
          attendanceData = {};
          renderAttendance();
        }
      }

      function isPaid(record) {
        if (typeof record === 'object') return false;
        return record === 'P' || record === 'OF';
      }

      function calculateMonthStats(monthId, totalDays) {
        const records = attendanceData[monthId] || {};
        let paidCount = 0;
        for (let day = 1; day <= totalDays; day++) {
          if (isPaid(records[day])) paidCount++;
        }
        const perDaySalary = MONTHLY_SALARY / totalDays;
        const estimatedSalary = Math.round(paidCount * perDaySalary);
        return { paidCount, estimatedSalary };
      }

      function updateGlobalSummary() {
        let totalPaid = 0, totalEstimated = 0;
        months.forEach(m => {
          const stats = calculateMonthStats(m.name.replace(/-/g, '_').toLowerCase(), m.days);
          totalPaid += stats.paidCount;
          totalEstimated += stats.estimatedSalary;
        });
        document.getElementById('globalSummary').innerHTML = `
          üí∞ Monthly Salary: ‚Çπ${MONTHLY_SALARY} | 
          üìÖ Total Paid Days: ${totalPaid} | 
          üíµ Estimated Earnings: ‚Çπ${totalEstimated}
        `;
      }

      let currentDayKey = null;

      function openLeaveModal(monthId, day, currentReason = '') {
        currentDayKey = { monthId, day };
        document.getElementById('leaveReasonInput').value = currentReason;
        document.getElementById('leaveModal').style.display = 'block';
        document.getElementById('leaveReasonInput').focus();
      }
      function closeLeaveModal() {
        document.getElementById('leaveModal').style.display = 'none';
        currentDayKey = null;
      }

      function saveLeaveReason() {
        if (!currentDayKey) return;
        const reason = (document.getElementById('leaveReasonInput').value.trim() || 'No reason').substring(0, 50);
        attendanceData[currentDayKey.monthId][currentDayKey.day] = { status: 'LV', reason };
        localStorage.setItem('attendanceData', JSON.stringify(attendanceData));
        closeLeaveModal();
        renderAttendance();
        updateGlobalSummary();
      }

      function renderAttendance() {
        const container = document.getElementById('attendanceContainer');
        container.innerHTML = '';

        months.forEach(month => {
          const monthId = month.name.replace(/-/g, '_').toLowerCase();
          if (!attendanceData[monthId]) {
            attendanceData[monthId] = {};
            for (let i = 1; i <= month.days; i++) attendanceData[monthId][i] = '';
          }

          const stats = calculateMonthStats(monthId, month.days);
          const monthDiv = document.createElement('div');
          monthDiv.className = 'month-section';

          const printBtn = document.createElement('button');
          printBtn.className = 'print-btn no-print';
          printBtn.innerHTML = 'üñ®Ô∏è';
          printBtn.title = `Print ${month.name}`;
          printBtn.onclick = () => printMonth(month.name, monthId, month.days);
          monthDiv.appendChild(printBtn);

          const header = document.createElement('div');
          header.className = 'month-header';
          header.innerHTML = `${month.name} <span>‚úÖ Paid: ${stats.paidCount} | üíµ ‚Çπ${stats.estimatedSalary}</span>`;

          const daysRow = document.createElement('div');
          daysRow.className = 'days-row';

          for (let day = 1; day <= month.days; day++) {
            const cell = document.createElement('div');
            cell.className = 'day-cell';

            const label = document.createElement('div');            label.className = 'day-label';
            label.textContent = day;
            const record = attendanceData[monthId][day];
            let status = '';
            let reason = '';

            if (typeof record === 'object' && record.status === 'LV') {
              status = 'LV';
              reason = record.reason || 'No reason';
            } else {
              status = record || '';
            }

            const btn = document.createElement('button');
            btn.className = `status-btn status-${status || 'empty'}`;
            btn.textContent = status || '-';

            if (status === 'LV') {
              const reasonEl = document.createElement('div');
              reasonEl.className = 'lv-reason';
              reasonEl.textContent = reason;
              cell.appendChild(reasonEl);
            }

            btn.addEventListener('click', () => {
              let nextStatus = '';
              if (status === '') nextStatus = 'P';
              else if (status === 'P') nextStatus = 'OF';
              else if (status === 'OF') nextStatus = 'LV';
              else if (status === 'LV') nextStatus = '';

              if (nextStatus === 'LV') {
                openLeaveModal(monthId, day, reason);
              } else {
                attendanceData[monthId][day] = nextStatus;
                localStorage.setItem('attendanceData', JSON.stringify(attendanceData));
                renderAttendance();
                updateGlobalSummary();
              }
            });

            cell.appendChild(label);
            cell.appendChild(btn);
            daysRow.appendChild(cell);
          }

          monthDiv.appendChild(header);
          monthDiv.appendChild(daysRow);
          container.appendChild(monthDiv);
        });        updateGlobalSummary();
      }

      document.getElementById('updateSalaryBtn').addEventListener('click', updateSalary);
      document.getElementById('salaryInput').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') updateSalary();
      });

      document.getElementById('exportBtn').addEventListener('click', exportData);
      document.getElementById('importBtn').addEventListener('click', () => {
        document.getElementById('fileInput').click();
      });
      document.getElementById('resetBtn').addEventListener('click', resetData);
      document.getElementById('fileInput').addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = (ev) => importData(ev.target.result);
          reader.readAsText(file);
        }
      });

      document.getElementById('saveLeaveBtn').addEventListener('click', saveLeaveReason);
      document.getElementById('cancelLeaveBtn').addEventListener('click', () => {
        closeLeaveModal();
        if (currentDayKey) {
          const { monthId, day } = currentDayKey;
          attendanceData[monthId][day] = 'OF';
          localStorage.setItem('attendanceData', JSON.stringify(attendanceData));
          renderAttendance();
          updateGlobalSummary();
        }
      });

      window.addEventListener('click', (e) => {
        if (e.target.id === 'leaveModal') closeLeaveModal();
      });

      renderAttendance();
      checkTodayAttendance();
    }
  </script>
</body>
</html>